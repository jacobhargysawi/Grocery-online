<!DOCTYPE html>
<html>
<head>
    <title>Sales Report - Grocery Management system at Al ixsaan</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        @media print {
            .no-print { display: none; }
        }
        .chart-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        window.onload = function() {
            window.print();
        }
    </script>
</head>
<body class="p-4">
    <div class="text-center mb-4">
        <h4 class="mb-0">Sales Report</h4>
        <small>Seller: {{ seller.username }} | {{ start_date }} â†’ {{ end_date }}</small>
    </div>

    <!-- Table Summary -->
    <table class="table table-bordered">
        <thead class="table-light">
            <tr>
                <th>Product</th>
                <th>Quantity Sold</th>
                <th>Total Revenue</th>
            </tr>
        </thead>
        <tbody>
            {% for name, data in products.items %}
            <tr>
                <td>{{ name }}</td>
                <td>{{ data.qty }}</td>
                <td>${{ data.revenue|floatformat:2 }}</td>
            </tr>
            {% endfor %}
            <tr class="fw-bold table-light">
                <td colspan="2" class="text-end">Grand Total:</td>
                <td class="text-success">${{ total|floatformat:2 }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Charts Section -->
    <div class="chart-container">
        <h6 class="text-center">ðŸ“Š Profit by Product</h6>
        <canvas id="profitChart"></canvas>
    </div>

    <div class="chart-container">
        <h6 class="text-center">ðŸ›’ Quantity Sold by Product</h6>
        <canvas id="quantityChart"></canvas>
    </div>

    <p class="text-muted text-end"><em>Generated by {{ seller.username }}</em></p>

    <script>
        const productNames = {{ product_names|safe }};
        const revenueValues = {{ revenue_values|safe }};
        const quantityValues = {{ quantity_values|safe }};

        new Chart(document.getElementById('profitChart'), {
            type: 'pie',
            data: {
                labels: productNames,
                datasets: [{
                    data: revenueValues,
                    backgroundColor: ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1']
                }]
            },
            options: { responsive: true }
        });

        new Chart(document.getElementById('quantityChart'), {
            type: 'doughnut',
            data: {
                labels: productNames,
                datasets: [{
                    data: quantityValues,
                    backgroundColor: ['#20c997', '#fd7e14', '#6610f2', '#e83e8c', '#17a2b8']
                }]
            },
            options: {
                cutout: '60%',
                plugins: { legend: { position: 'bottom' } },
                responsive: true
            }
        });
    </script>
</body>
</html>